<ng-container
  *ngIf="
    !(isRecoveringForgotPassword | async);
    then formenteremail;
    else formentercode
  "
></ng-container>
<ng-template #formenteremail>
  <div class="pt-5">
    <h2 class="font-bold text-4xl">Bạn đã quên mật khẩu của mình?</h2>
    <p class="text-sm text-gray-300 italic">
      Hãy nhập địa chỉ email liên kết tới tài khoản của bạn
    </p>
  </div>
  <form
    nz-form
    [formGroup]="forgotPasswordForm"
    (ngSubmit)="submitForm()"
    class="forgotpsw-form"
  >
    <nz-form-item>
      <nz-form-label
        [nzSm]="24"
        [nzXs]="24"
        nzRequired
        nzFor="email"
        class="text-start"
        >Email</nz-form-label
      >
      <nz-form-control
        [nzSm]="24"
        [nzXs]="24"
        nzErrorTip="Email được nhập không lệ!"
      >
        <nz-input-group nzPrefixIcon="mail">
          <input
            nz-input
            formControlName="email"
            id="email"
            placeholder="exmaple@gmail.com"
          />
        </nz-input-group>
      </nz-form-control>
    </nz-form-item>
    <button
      nz-button
      class="login-form-button login-form-margin w-full"
      [nzType]="'primary'"
    >
      Tiếp
    </button>
  </form>
</ng-template>

<ng-template #formentercode>
  <div class="pt-5">
    <h2 class="font-normal text-4xl leading-normal">
      Xác thực mã được gửi qua <b><mark>Email</mark></b>
    </h2>
    <p class="text-sm text-gray-300 italic">
      Làm ơn hãy nhập mã code được gửi cho bạn.
    </p>
  </div>
  <form nz-form [formGroup]="enterCodeForm" (ngSubmit)="submitCodeForm()">
    <nz-form-item>
      <nz-form-label
        [nzSm]="24"
        [nzXs]="24"
        nzRequired
        nzFor="code"
        class="text-start"
        >Mã</nz-form-label
      >
      <div nz-row [nzGutter]="8" nzJustify="center">
        <div nz-col nzSpan="4" *ngFor="let number of [1, 2, 3, 4, 5, 6]">
          <nz-form-control [nzSm]="24" [nzXs]="24">
            <input
              type="text"
              nz-input
              class="text-center text-lg"
              [formControlName]="'number' + number"
              appNumberOnly
              [nzStatus]="
                enterCodeForm.get('number' + number)!.invalid &&
                enterCodeForm.get('number' + number)!.touched
                  ? 'error'
                  : ''
              "
            />
          </nz-form-control>
        </div>
      </div>
      <div *ngIf="otpErrorMessage" class="text-red-500">
        {{ otpErrorMessage }}
      </div>
    </nz-form-item>
    <div class="text-center p-3">
      Bạn không nhận đc mã?
      <span
        [ngClass]="{
          'text-blue-600 font-bold underline cursor-pointer':
            !isTimeClockInitialized,
          'text-gray-600': isTimeClockInitialized
        }"
        (click)="onSendAgainCode()"
      >
        Gửi lại mã
        <ng-container *ngIf="isTimeClockInitialized">
          ({{ (timeClock$ | async)?.minutes }} :
          {{ (timeClock$ | async)?.seconds }})
        </ng-container>
      </span>
    </div>
    <button
      nz-button
      class="login-form-button login-form-margin w-full"
      [nzType]="'primary'"
      [disabled]="!isEnterCodeValid"
    >
      Lấy lại mật khẩu
    </button>
  </form>
</ng-template>
